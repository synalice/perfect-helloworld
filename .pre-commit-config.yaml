repos:
  - repo: local
    hooks:
      - id: clang-format
        name: Format code with clang-format
        language: system
        entry: nix develop -c clang-format -i
        types_or: [c, header]
        pass_filenames: true

      - id: meson-format
        name: Format meson.build files
        language: system
        entry: nix develop -c meson format -i
        types_or: [meson]
        pass_filenames: true

      - id: nix-flake-check
        name: Lint flake.nix
        language: system
        entry: nix develop -c nix flake check
        types_or: [nix]
        pass_filenames: false

      - id: nix-fmt
        name: Format flake.nix
        language: system
        entry: nix develop -c nix fmt
        types_or: [nix]
        pass_filenames: true

      - id: meson-setup
        name: Setup builddir
        language: system
        entry: nix develop -c meson setup builddir/
        types_or: [c, header]
        pass_filenames: false

      - id: iwyu
        name: Run IWYU tool
        language: system
        entry: nix develop -c iwyu_tool.py -p builddir/ -o clang -- -Xiwyu --error=1
        types_or: [c, header]
        pass_filenames: false

      - id: cppcheck
        name: Run cppcheck
        language: system
        entry: nix develop -c cppcheck
        args:
          - --enable=all
          - --safety
          - --language=c
          - --platform=unspecified
          - --std=c11
          - --error-exitcode=1
          - --suppress=missingIncludeSystem
          - --suppress=unmatchedSuppression
          - --suppress=checkersReport
          - --project=builddir/compile_commands.json
        types_or: [c, header]
        pass_filenames: false

      - id: clang-tidy
        name: Run clang-tidy
        language: system
        entry: nix develop -c ninja -C builddir/ clang-tidy
        types_or: [c, header]
        pass_filenames: false

      - id: scan-build
        name: Run scan-build
        language: system
        entry: nix develop -c scripts/run-scan-build.sh
        types_or: [c, header]
        pass_filenames: false
